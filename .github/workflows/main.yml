[name: RDP](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
  
[on:](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[  workflow_dispatch:](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
  
[jobs:](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[  secure-rdp:](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[    runs-on: windows-latest](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[    timeout-minutes: 3600](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
  
[    steps:](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[      - name: Configure Core RDP Settings](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[        run: |](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          # Enable Remote Desktop and disable Network Level Authentication (if needed)](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' `](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[                             -Name "fDenyTSConnections" -Value 0 -Force](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' `](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[                             -Name "UserAuthentication" -Value 0 -Force](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' `](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[                             -Name "SecurityLayer" -Value 0 -Force](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
  
[          # Remove any existing rule with the same name to avoid duplication](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          netsh advfirewall firewall delete rule name="RDP-Tailscale"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          ](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          # For testing, allow any incoming connection on port 3389](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          netsh advfirewall firewall add rule name="RDP-Tailscale" `](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[            dir=in action=allow protocol=TCP localport=3389](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
  
[          # (Optional) Restart the Remote Desktop service to ensure changes take effect](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Restart-Service -Name TermService -Force](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
  
[      - name: Create RDP User with Secure Password](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[        run: |](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Add-Type -AssemblyName System.Security](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $charSet = @{](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              Upper   = [char[]](65..90)      # A-Z](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              Lower   = [char[]](97..122)     # a-z](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              Number  = [char[]](48..57)      # 0-9](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              Special = ([char[]](33..47) + [char[]](58..64) +](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[                         [char[]](91..96) + [char[]](123..126)) # Special characters](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          }](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $rawPassword = @()](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $rawPassword += $charSet.Upper | Get-Random -Count 4](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $rawPassword += $charSet.Lower | Get-Random -Count 4](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $rawPassword += $charSet.Number | Get-Random -Count 4](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $rawPassword += $charSet.Special | Get-Random -Count 4](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $password = -join ($rawPassword | Sort-Object { Get-Random })](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $securePass = ConvertTo-SecureString $password -AsPlainText -Force](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          New-LocalUser -Name "RDP" -Password $securePass -AccountNeverExpires](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Add-LocalGroupMember -Group "Administrators" -Member "RDP"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Add-LocalGroupMember -Group "Remote Desktop Users" -Member "RDP"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          ](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          echo "RDP_CREDS=User: RDP | Password: $password" >> $env:GITHUB_ENV](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          ](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          if (-not (Get-LocalUser -Name "RDP")) {](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              Write-Error "User creation failed"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              exit 1](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          }](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
  
[      - name: Install Tailscale](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[        run: |](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $installerPath = "$env:TEMP\tailscale.msi"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          ](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Invoke-WebRequest -Uri $tsUrl -OutFile $installerPath](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Start-Process msiexec.exe -ArgumentList "/i", "`"$installerPath`"", "/quiet", "/norestart" -Wait](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Remove-Item $installerPath -Force](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
  
[      - name: Establish Tailscale Connection](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[        run: |](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          # Bring up Tailscale with the provided auth key and set a unique hostname](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=gh-runner-$env:GITHUB_RUN_ID](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          ](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          # Wait for Tailscale to assign an IP](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $tsIP = $null](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $retries = 0](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          while (-not $tsIP -and $retries -lt 10) {](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              $tsIP = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              Start-Sleep -Seconds 5](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              $retries++](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          }](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          ](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          if (-not $tsIP) {](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              Write-Error "Tailscale IP not assigned. Exiting."](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              exit 1](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          }](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          echo "TAILSCALE_IP=$tsIP" >> $env:GITHUB_ENV](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[      ](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[      - name: Verify RDP Accessibility](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[        run: |](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Write-Host "Tailscale IP: $env:TAILSCALE_IP"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          ](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          # Test connectivity using Test-NetConnection against the Tailscale IP on port 3389](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          $testResult = Test-NetConnection -ComputerName $env:TAILSCALE_IP -Port 3389](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          if (-not $testResult.TcpTestSucceeded) {](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              Write-Error "TCP connection to RDP port 3389 failed"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              exit 1](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          }](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Write-Host "TCP connectivity successful!"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
  
[      - name: Maintain Connection](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[        run: |](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Write-Host "`n=== RDP ACCESS ==="](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Write-Host "Address: $env:TAILSCALE_IP"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Write-Host "Username: RDP"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Write-Host "Password: $(echo $env:RDP_CREDS)"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          Write-Host "==================`n"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          ](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          # Keep runner active indefinitely (or until manually cancelled)](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          while ($true) {](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              Write-Host "[$(Get-Date)] RDP Active - Use Ctrl+C in workflow to terminate"](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[              Start-Sleep -Seconds 300](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
[          }](name:%20RDP%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20secure-rdp%3A%0A%20%20%20%20runs-on%3A%20windows-latest%0A%20%20%20%20timeout-minutes%3A%203600%0A%0A%20%20%20%20steps%3A%0A%20%20%20%20%20%20-%20name%3A%20Configure%20Core%20RDP%20Settings%0A%20%20%20%20%20%20%20%20run%3A%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Enable%20Remote%20Desktop%20and%20disable%20Network%20Level%20Authentication%20(if%20needed)%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22fDenyTSConnections%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22UserAuthentication%22%20-Value%200%20-Force%0A%20%20%20%20%20%20%20%20%20%20Set-ItemProperty%20-Path%20'HKLM:%5CSystem%5CCurrentControlSet%5CControl%5CTerminal%20Server%5CWinStations%5CRDP-Tcp'%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-Name%20%22SecurityLayer%22%20-Value%200%20-Force%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20any%20existing%20rule%20with%20the%20same%20name%20to%20avoid%20duplication%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20delete%20rule%20name=%22RDP-Tailscale%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20For%20testing,%20allow%20any%20incoming%20connection%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20netsh%20advfirewall%20firewall%20add%20rule%20name=%22RDP-Tailscale%22%20%60%0A%20%20%20%20%20%20%20%20%20%20%20%20dir=in%20action=allow%20protocol=TCP%20localport=3389%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20(Optional)%20Restart%20the%20Remote%20Desktop%20service%20to%20ensure%20changes%20take%20effect%0A%20%20%20%20%20%20%20%20%20%20Restart-Service%20-Name%20TermService%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Create%20RDP%20User%20with%20Secure%20Password%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Add-Type%20-AssemblyName%20System.Security%0A%20%20%20%20%20%20%20%20%20%20$charSet%20=%20@%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Upper%20%20%20=%20%5Bchar%5B%5D%5D(65..90)%20%20%20%20%20%20%23%20A-Z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Lower%20%20%20=%20%5Bchar%5B%5D%5D(97..122)%20%20%20%20%20%23%20a-z%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Number%20%20=%20%5Bchar%5B%5D%5D(48..57)%20%20%20%20%20%20%23%200-9%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Special%20=%20(%5Bchar%5B%5D%5D(33..47)%20+%20%5Bchar%5B%5D%5D(58..64)%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bchar%5B%5D%5D(91..96)%20+%20%5Bchar%5B%5D%5D(123..126))%20%23%20Special%20characters%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20=%20@()%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Upper%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Lower%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Number%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$rawPassword%20+=%20$charSet.Special%20%7C%20Get-Random%20-Count%204%0A%20%20%20%20%20%20%20%20%20%20$password%20=%20-join%20($rawPassword%20%7C%20Sort-Object%20%7B%20Get-Random%20%7D)%0A%20%20%20%20%20%20%20%20%20%20$securePass%20=%20ConvertTo-SecureString%20$password%20-AsPlainText%20-Force%0A%20%20%20%20%20%20%20%20%20%20New-LocalUser%20-Name%20%22RDP%22%20-Password%20$securePass%20-AccountNeverExpires%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20Add-LocalGroupMember%20-Group%20%22Remote%20Desktop%20Users%22%20-Member%20%22RDP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20echo%20%22RDP_CREDS=User:%20RDP%20%7C%20Password:%20$password%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20(Get-LocalUser%20-Name%20%22RDP%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22User%20creation%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20-%20name:%20Install%20Tailscale%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20$tsUrl%20=%20%22https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi%22%0A%20%20%20%20%20%20%20%20%20%20$installerPath%20=%20%22$env:TEMP%5Ctailscale.msi%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20Invoke-WebRequest%20-Uri%20$tsUrl%20-OutFile%20$installerPath%0A%20%20%20%20%20%20%20%20%20%20Start-Process%20msiexec.exe%20-ArgumentList%20%22/i%22,%20%22%60%22$installerPath%60%22%22,%20%22/quiet%22,%20%22/norestart%22%20-Wait%0A%20%20%20%20%20%20%20%20%20%20Remove-Item%20$installerPath%20-Force%0A%0A%20%20%20%20%20%20-%20name:%20Establish%20Tailscale%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%23%20Bring%20up%20Tailscale%20with%20the%20provided%20auth%20key%20and%20set%20a%20unique%20hostname%0A%20%20%20%20%20%20%20%20%20%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20up%20--authkey=$%7B%7B%20secrets.TAILSCALE_AUTH_KEY%20%7D%7D%20--hostname=gh-runner-$env:GITHUB_RUN_ID%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Wait%20for%20Tailscale%20to%20assign%20an%20IP%0A%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20$null%0A%20%20%20%20%20%20%20%20%20%20$retries%20=%200%0A%20%20%20%20%20%20%20%20%20%20while%20(-not%20$tsIP%20-and%20$retries%20-lt%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$tsIP%20=%20&%20%22$env:ProgramFiles%5CTailscale%5Ctailscale.exe%22%20ip%20-4%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20$retries++%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$tsIP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22Tailscale%20IP%20not%20assigned.%20Exiting.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20echo%20%22TAILSCALE_IP=$tsIP%22%20%3E%3E%20$env:GITHUB_ENV%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20-%20name:%20Verify%20RDP%20Accessibility%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Tailscale%20IP:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Test%20connectivity%20using%20Test-NetConnection%20against%20the%20Tailscale%20IP%20on%20port%203389%0A%20%20%20%20%20%20%20%20%20%20$testResult%20=%20Test-NetConnection%20-ComputerName%20$env:TAILSCALE_IP%20-Port%203389%0A%20%20%20%20%20%20%20%20%20%20if%20(-not%20$testResult.TcpTestSucceeded)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Error%20%22TCP%20connection%20to%20RDP%20port%203389%20failed%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22TCP%20connectivity%20successful!%22%0A%0A%20%20%20%20%20%20-%20name:%20Maintain%20Connection%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%60n===%20RDP%20ACCESS%20===%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Address:%20$env:TAILSCALE_IP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Username:%20RDP%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22Password:%20$(echo%20$env:RDP_CREDS)%22%0A%20%20%20%20%20%20%20%20%20%20Write-Host%20%22==================%60n%22%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%23%20Keep%20runner%20active%20indefinitely%20(or%20until%20manually%20cancelled)%0A%20%20%20%20%20%20%20%20%20%20while%20($true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Write-Host%20%22%5B$(Get-Date)%5D%20RDP%20Active%20-%20Use%20Ctrl+C%20in%20workflow%20to%20terminate%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Start-Sleep%20-Seconds%20300%0A%20%20%20%20%20%20%20%20%20%20%7D)  
